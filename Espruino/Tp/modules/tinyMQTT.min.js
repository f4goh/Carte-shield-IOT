function l(b){if(3===b.charCodeAt(0)>>4){var c=b.length,d=b.charCodeAt(1),h=b.charCodeAt(2)<<8|b.charCodeAt(3);h={topic:b.substr(4,h),message:b.substr(4+h,d-h-2)};a.emit("message",h);c>d+2&&l(b.substr(d+2,c-d))}}function f(b){return e(b.length>>8,b.length&255)+b}function k(b,c,d){return e(b,c.length+d.length)+c+d}function m(b){var c=0;b=f(b);a.usr&&a.pwd&&(c|=a.usr?128:0,c|=a.usr&&a.pwd?64:0,b+=f(a.usr)+f(a.pwd));return k(16,f("MQTT")+e(4,c,255,255),b)}var a,g=function(b,
c){c=c||{};this.svr=b;this.prt=c.port||1883;this.ka=c.keep_alive||60;this.usr=c.username;this.pwd=c.password;this.cn=!1;this.ri=c.reconnect_interval||2E3;a=this},e=String.fromCharCode;g.prototype._scktClosed=function(){a.con&&(clearInterval(a.con),a.con=null);a.x1&&(clearInterval(a.x1),a.x1=null);a.cn=!1;delete a.cl;a.emit("disconnected")};g.prototype.connect=function(){var b=function(){a.con&&(clearInterval(a.con),a.con=null);try{a.cl.write(m(getSerial())),a.emit("connected"),a.cn=!0,a.x1=setInterval(function(){a.cn&&
a.cl.write(e(192,0))},a.ka<<10),a.cl.on("data",l.bind(a)),a.cl.on("end",a._scktClosed)}catch(c){a._scktClosed()}};a.cn||a.con||(a.con=setInterval(function(){a.cl&&(a.cl.end(),delete a.cl);try{a.cl=require("net").connect({host:a.svr,port:a.prt},b)}catch(c){a._scktClosed()}},a.ri))};g.prototype.subscribe=function(b){a.cl.write(k(130,e(256,1),f(b)+e(1)))};g.prototype.publish=function(b,c){if(127<b.length+c.length)throw"tMQTT-TL";a.cn&&(a.cl.write(k(49,f(b),c)),a.emit("published"))};g.prototype.disconnect=
function(){if(a.cn)try{a.cl.write(e(224,0))}catch(b){a._scktClosed()}};exports.create=function(b,c){return new g(b,c)}